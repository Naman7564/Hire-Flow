{% extends "dashboard/base_dashboard.html" %}

{% block title %}Edit Profile{% endblock %}
{% block page_title %}Edit Profile{% endblock %}

{% block content %}
<div class="card fade-in-up" style="max-width: 800px;">
    <div class="card-header">
        <h3><i class="fas fa-user-edit"></i> Update Your Profile</h3>
    </div>
    <div class="card-body">
        <form method="post" enctype="multipart/form-data" data-validate>
            {% csrf_token %}

            <h3
                style="font-size: 0.9rem; color: var(--text-primary); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border-light);">
                Basic Information
            </h3>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_first_name">First Name</label>
                    <input type="text" name="first_name" id="id_first_name" class="form-control"
                        value="{{ user_form.instance.first_name }}" required>
                    {{ user_form.first_name.errors }}
                </div>
                <div class="form-group">
                    <label for="id_last_name">Last Name</label>
                    <input type="text" name="last_name" id="id_last_name" class="form-control"
                        value="{{ user_form.instance.last_name }}" required>
                    {{ user_form.last_name.errors }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_email">Email</label>
                    <input type="email" name="email" id="id_email" class="form-control"
                        value="{{ user_form.instance.email }}" required>
                    {{ user_form.email.errors }}
                </div>
                <div class="form-group">
                    <label for="id_phone">Phone</label>
                    <input type="text" name="phone" id="id_phone" class="form-control"
                        value="{{ user_form.instance.phone|default:'' }}" placeholder="+91 99999 99999">
                    {{ user_form.phone.errors }}
                </div>
            </div>

            <div class="form-group">
                <label for="id_avatar">Profile Photo</label>
                <div class="file-upload">
                    <input type="file" name="avatar" id="id_avatar" accept="image/*">
                </div>
                {% if user.avatar %}
                <p class="form-help">Current: {{ user.avatar.name }}</p>
                {% endif %}
            </div>

            {% if profile_form %}
            <h3
                style="font-size: 0.9rem; color: var(--text-primary); margin: 24px 0 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border-light);">
                Professional Details
            </h3>

            <div class="form-group">
                <label for="id_headline">Professional Headline</label>
                <input type="text" name="headline" id="id_headline" class="form-control"
                    value="{{ profile_form.instance.headline }}"
                    placeholder="e.g., Full Stack Developer | Python & React Expert">
            </div>

            <div class="form-group">
                <label for="id_bio">Bio / Summary</label>
                <textarea name="bio" id="id_bio" class="form-control" rows="4"
                    placeholder="Tell recruiters about yourself...">{{ profile_form.instance.bio }}</textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_skills">Skills</label>
                    <input type="text" name="skills" id="id_skills" class="form-control"
                        value="{{ profile_form.instance.skills }}" placeholder="Python, Django, JavaScript, React...">
                    <p class="form-help">Comma-separated skills</p>
                </div>
                <div class="form-group">
                    <label for="id_experience_years">Years of Experience</label>
                    <input type="number" name="experience_years" id="id_experience_years" class="form-control"
                        value="{{ profile_form.instance.experience_years }}" min="0" max="50">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_location">Location</label>
                    <input type="text" name="location" id="id_location" class="form-control"
                        value="{{ profile_form.instance.location }}" placeholder="Mumbai, India">
                </div>
                <div class="form-group">
                    <label for="id_resume">Resume (PDF/DOC)</label>
                    <div class="file-upload">
                        <input type="file" name="resume" id="id_resume" accept=".pdf,.doc,.docx">
                    </div>
                    {% if profile_form.instance.resume %}
                    <p class="form-help">Current: {{ profile_form.instance.resume.name }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <label for="id_education">Education</label>
                <textarea name="education" id="id_education" class="form-control" rows="3"
                    placeholder="B.Tech in Computer Science, IIT Delhi (2020-2024)">{{ profile_form.instance.education }}</textarea>
            </div>

            <h3
                style="font-size: 0.9rem; color: var(--text-primary); margin: 24px 0 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border-light);">
                Social Links
            </h3>

            <div class="form-group">
                <label for="id_linkedin_url"><i class="fab fa-linkedin"></i> LinkedIn</label>
                <input type="url" name="linkedin_url" id="id_linkedin_url" class="form-control"
                    value="{{ profile_form.instance.linkedin_url }}" placeholder="https://linkedin.com/in/username">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_github_url"><i class="fab fa-github"></i> GitHub</label>
                    <input type="url" name="github_url" id="id_github_url" class="form-control"
                        value="{{ profile_form.instance.github_url }}" placeholder="https://github.com/username">
                </div>
                <div class="form-group">
                    <label for="id_portfolio_url"><i class="fas fa-globe"></i> Portfolio</label>
                    <input type="url" name="portfolio_url" id="id_portfolio_url" class="form-control"
                        value="{{ profile_form.instance.portfolio_url }}" placeholder="https://portfolio.com">
                </div>
            </div>
            {% endif %}

            <div class="btn-group" style="margin-top: 24px;">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <a href="{% url 'accounts:profile' %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        initSkillsInput('id_skills');
    });
</script>
{% endblock %}