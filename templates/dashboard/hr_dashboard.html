{% extends "dashboard/base_dashboard.html" %}

{% block title %}HR Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div style="margin-bottom: 28px;">
    <h2 style="font-size: 1.5rem; font-weight: 800; margin-bottom: 4px;">
        Welcome, {{ user.first_name|default:user.username }}!
        <span
            style="font-size: 0.75rem; background: rgba(99, 102, 241, 0.15); color: var(--accent-primary-hover); padding: 4px 12px; border-radius: 12px; font-weight: 600; vertical-align: middle; margin-left: 8px;">HR
            Admin</span>
    </h2>
    <p style="color: var(--text-secondary); font-size: 0.9rem;">Here's your recruitment overview for today</p>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card indigo fade-in-up stagger-1">
        <div class="stat-icon"><i class="fas fa-briefcase"></i></div>
        <div class="stat-value">{{ active_jobs }}</div>
        <div class="stat-label">Active Jobs</div>
    </div>

    <div class="stat-card green fade-in-up stagger-2">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div class="stat-value">{{ total_candidates }}</div>
        <div class="stat-label">Total Candidates</div>
    </div>

    <div class="stat-card blue fade-in-up stagger-3">
        <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
        <div class="stat-value">{{ total_applications }}</div>
        <div class="stat-label">Total Applications</div>
    </div>

    <div class="stat-card purple fade-in-up stagger-4">
        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
        <div class="stat-value">{{ hired_count }}</div>
        <div class="stat-label">Hired</div>
    </div>
</div>

<!-- Main Grid -->
<div class="dashboard-grid three-col">
    <!-- Pipeline Chart -->
    <div class="card fade-in-up">
        <div class="card-header">
            <h3><i class="fas fa-chart-bar"></i> Hiring Pipeline</h3>
        </div>
        <div class="card-body">
            <div class="chart-container">
                <canvas id="pipelineChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Hired Stats -->
    <div class="card fade-in-up">
        <div class="card-header">
            <h3><i class="fas fa-trophy"></i> Hires Statistic</h3>
        </div>
        <div class="card-body">
            <div class="big-stat">
                <div class="big-number">{{ hired_count|default:0 }}</div>
                <div class="big-label">Total Hired</div>
            </div>
            <div style="text-align: center; margin-top: 16px;">
                <div style="display: flex; justify-content: center; gap: 24px;">
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: var(--accent-purple);">{{ interview_count|default:0 }}</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Interviews</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: var(--accent-blue);">{{ shortlisted_count|default:0 }}</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Shortlisted</div>
                    </div>
                    <div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: var(--accent-yellow);">{{ total_jobs }}</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Total Jobs</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pipeline Overview Bar -->
<div class="card fade-in-up" style="margin-bottom: 20px;">
    <div class="card-header">
        <h3><i class="fas fa-stream"></i> Pipeline Overview</h3>
    </div>
    <div class="card-body">
        {% if total_applications > 0 %}
        <div style="display: flex; justify-content: space-around; margin-bottom: 16px;">
            <div style="text-align: center;">
                <div
                    style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px;">
                    New Candidates</div>
                <div style="font-size: 1.3rem; font-weight: 700;">{{ pipeline_data.applied|default:0 }}</div>
            </div>
            <div style="text-align: center;">
                <div
                    style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px;">
                    Shortlisted</div>
                <div style="font-size: 1.3rem; font-weight: 700;">{{ shortlisted_count }}</div>
            </div>
            <div style="text-align: center;">
                <div
                    style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px;">
                    Interviews</div>
                <div style="font-size: 1.3rem; font-weight: 700;">{{ interview_count }}</div>
            </div>
        </div>
        <div class="pipeline-bar">
            {% widthratio pipeline_data.applied|default:0 total_applications 100 as applied_pct %}
            <div class="segment applied"
                style="width: {% widthratio pipeline_data.applied|default:0 total_applications 100 %}%;"></div>
            <div class="segment reviewing"
                style="width: {% widthratio pipeline_data.reviewing|default:0 total_applications 100 %}%;"></div>
            <div class="segment shortlisted"
                style="width: {% widthratio pipeline_data.shortlisted|default:0 total_applications 100 %}%;"></div>
            <div class="segment interview"
                style="width: {% widthratio pipeline_data.interview|default:0 total_applications 100 %}%;"></div>
            <div class="segment hired"
                style="width: {% widthratio pipeline_data.hired|default:0 total_applications 100 %}%;"></div>
            <div class="segment rejected"
                style="width: {% widthratio pipeline_data.rejected|default:0 total_applications 100 %}%;"></div>
        </div>
        <div class="pipeline-legend">
            <div class="legend-item"><span class="legend-dot" style="background: #6366f1;"></span> Applied</div>
            <div class="legend-item"><span class="legend-dot" style="background: #f59e0b;"></span> Reviewing</div>
            <div class="legend-item"><span class="legend-dot" style="background: #3b82f6;"></span> Shortlisted</div>
            <div class="legend-item"><span class="legend-dot" style="background: #8b5cf6;"></span> Interview</div>
            <div class="legend-item"><span class="legend-dot" style="background: #10b981;"></span> Hired</div>
            <div class="legend-item"><span class="legend-dot" style="background: #ef4444;"></span> Rejected</div>
        </div>
        {% else %}
        <div class="empty-state" style="padding: 30px;">
            <p>No applications yet. Create a job posting to start receiving applications.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Recent Applications Table -->
<div class="card fade-in-up">
    <div class="card-header">
        <h3><i class="fas fa-clock"></i> Top Candidates</h3>
        <a href="{% url 'applications:all_applications' %}" class="card-action">View all â†’</a>
    </div>
    <div class="card-body no-padding">
        {% if recent_applications %}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Status</th>
                        <th>Applied</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for app in recent_applications %}
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div
                                    style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; color: white; flex-shrink: 0;">
                                    {{ app.candidate.first_name|first|default:"?" }}
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">{{ app.candidate.display_name }}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted);">{{ app.candidate.email }}</div>
                                </div>
                            </div>
                        </td>
                        <td>{{ app.job.title }}</td>
                        <td><span class="status-badge {{ app.status }}">{{ app.get_status_display }}</span></td>
                        <td>{{ app.applied_at|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'applications:update_status' app.pk %}" class="btn btn-sm btn-secondary">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ðŸ“‹</div>
            <h3>No Applications Yet</h3>
            <p>Applications will appear here once candidates start applying.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const labels = {{ status_labels|safe }};
        const data = {{ status_counts|safe }};
        const colors = ['#6366f1', '#f59e0b', '#3b82f6', '#8b5cf6', '#10b981', '#ef4444'];

        if (typeof drawPipelineChart === 'function' && document.getElementById('pipelineChart')) {
            drawPipelineChart('pipelineChart', labels, data, colors);
        }

        window.addEventListener('resize', function () {
            if (typeof drawPipelineChart === 'function' && document.getElementById('pipelineChart')) {
                drawPipelineChart('pipelineChart', labels, data, colors);
            }
        });
    });
</script>
{% endblock %}
